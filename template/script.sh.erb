#!/usr/bin/env bash

this_script="template/script.sh.erb"

log() {
    echo -e "[$(date -Iseconds)][${this_script}] $1"
}

# Benchmark info
log "Starting main script"

# Set working directory to home directory
cd "${HOME}"

# Load spack
. <%= context.spack %>/share/spack/setup-env.sh
log "Activated spack install"

#
# Start Jupyter Notebook Server
#

# Load the require environment
log "Loading environment: <%= context.environment %>"
spack env activate <%= context.environment %>
log "Spack environment loaded"

# Benchmark info
log "Starting jupyter"

# Launch the Jupyter Lab Server
set -x
jupyter lab --config="${CONFIG_FILE}" $CHECKPOINT_ARG <%= context.extra_jupyter_args %>
set +x
